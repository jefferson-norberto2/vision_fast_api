<!DOCTYPE html>
<html>
    <head>
        <title>Chat e Streaming de Webcam</title>
    </head>
    <body>
        <h1>WebSocket Chat e Streaming de Webcam</h1>
        <h2>Seu ID: <span id="ws-id"></span></h2>

        <!-- Formulário de envio de mensagem -->
        <form action="" onsubmit="sendMessage(event)">
            <input type="text" id="messageText" autocomplete="off" placeholder="Digite sua mensagem..."/>
            <button>Enviar</button>
        </form>

        <!-- Lista de mensagens -->
        <ul id='messages'></ul>

        <!-- Elemento para exibir o streaming de vídeo -->
        <h2>Streaming de Webcam</h2>
        <img id="video-stream" src="" alt="Webcam Stream"/>

        <script>
            // Gerar um ID de cliente único baseado no timestamp
            var client_id = Date.now();
            document.querySelector("#ws-id").textContent = client_id;

            // Estabelecer conexão WebSocket
            var ws = new WebSocket(`ws://localhost:8000/ws/${client_id}`);

            // Processar mensagens recebidas
            ws.onmessage = function(event) {
                // Diferenciar mensagens de texto e frames de imagem
                try {
                    var img = document.getElementById('video-stream');
                    img.src = 'data:image/jpeg;base64,' + event.data;
                } catch (error) {
                    var messages = document.getElementById('messages');
                    var message = document.createElement('li');
                    var content = document.createTextNode(event.data);
                    message.appendChild(content);
                    messages.appendChild(message);
                }
            };

            // Enviar mensagens através do WebSocket
            function sendMessage(event) {
                var input = document.getElementById("messageText");
                ws.send(input.value);
                input.value = '';
                event.preventDefault();
            }
        </script>
    </body>
</html>
